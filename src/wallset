#!/usr/bin/bash

wallpapers="$HOME/.backgrounds"
current="$HOME/.wallpaper"
save=0
newname=""
filepath=""

wallpaper_set()
{
    if [[ $1 == "http"* ]]; then
        wget -O "$current" "$1"
        hsetroot -cover "$current"
        exit 0
    fi
    
    test -f "$1" || error_exit "invalid file : $1"
    cp "$1" "$current"
    hsetroot -cover "$current"
}

error_exit()
{
    test "$1" == "" || echo "$1"; echo "abort..."; exit 1
    echo "*** usage :"
    echo "wallset"
    echo "wallset \"/path/to/file.jpg\""
    echo "wallset -save \"file_name\""
    echo "wallset -set \"file_name\""
    echo "wallset -list"
    echo "abort..."
    exit 1
}

test -d "$wallpapers" || mkdir -p "$wallpapers"

while (($#)); do
    case "$1" in
        -save)
            save=1
            test $# -gt 0 && shift; newname="$1"
        ;;
        -set)
            test $# -gt 0 && shift; filepath="$wallpapers/$1"
        ;;
        -list)
            ls -l "$wallpapers/"; exit 0
        ;;
        *)
            test "$filepath" == "" || error_exit
            filepath="$1"
        ;;
    esac
    shift
done

if [[ $save == 1 ]]; then
    test "$newname" != "" || error_exit
    echo "save : \"$newname\""
    cp "$HOME/.wallpaper" "$wallpapers/$newname"
    exit 0
fi

if [[ $filepath != "" ]]; then
    wallpaper_set "$filepath"
else
    wallpaper_set "https://picsum.photos/1680/1050?random"
fi


